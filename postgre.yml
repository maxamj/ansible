---
- hosts: postgre
     
  tasks:
  - name: Install PostgreSQL repo
    yum: name=https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm state=present    
  - name: Install PostgreSQL
    yum: name="{{ item }}" state=latest
    update_cache: yes
    enablerepo: "pgdg96"
    with_items:
      - "postgresql96"
      - "postgresql96-server"
      - "postgresql96-contrib"
      - "postgresql96-libs"
      - "postgresql96-devel"
      - python-psycopg2
      - cronie-anacron
      - cronie
      - crontabs   
                                  
- hosts: postgre
    
  tasks:
  - service:
    name: postgresql-9.6
    state: stopped
      
  - name: create data cluster
    command: /usr/pgsql-9.6/bin/postgresql96-setup initdb

- hosts: postgre
    
  tasks:
  - name: enable postgresql
    service: 
       name: 'postgresql-9.6'
       enabled: yes
       state: started
       daemon_reload: yes
  
#  - service:
#    name: postgresql-9.6
#    state: started

- hosts: postgre

  tasks:
  - name: Create db PostgreSQL
    become: yes
    become_user: postgres
    postgresql_db: 
      name: pgmax1
      encoding: UTF-8
      state: present
                                              
  - name: Create user PostgreSQL
    become: yes
    become_user: postgres
    postgresql_user:
      name: upg1
      password: "{{ pg_pass }}"
      db: pgmax1
      priv: ALL
      state: present
      encrypted: no